var inZkdjt = !1,
    inZkzx = !1,
    isEditIcon = "true",
    isEditTitle = "false",
    hideLogo = "true",
    hideAvatar = "false",
    hideSign = "false",
    isLook = "true",
    isLookTzid = ",";
const saveTzLength = 800,
    zkdjtPath = "tbody[id^='normalthread_']",
    zkzxPath = ".dt a[href*='/thread-']";
var tipsWords = "true",
    autoRefresh = 0,
    hideRemoveWord = "false",
    pushWords = "\u6C34,\u901F\u5EA6,\u6BDB,\u795E\u4EF7,\u624B\u6162\u65E0,bug,\u64B8,\u597D\u4EF7,\u7EA2\u5305,\u9996\u53D1,\u8BDD\u8D39,\u767D\u6761,\u4EAC\u4E1C,ysf,yzf",
    removeWords = "\uFF1F,?,\u53EF\u4EE5\u4E0D,\u54EA,\u597D\u70B9,\u4EC0\u4E48,\u600E\u4E48,\u6C42,\u6709*\u5417,\u6709*\u6CA1,\u662F\u4E0D\u662F";

var refreshTimer = null;
function initCheckbox(a, b, d) {
    chrome.extension.sendMessage({
        action: "getKey",
        data: {
            key: a,
            value: b
        }
    }, function(a) {
        200 == a.status && d && d(a.data)
    })
}
var main = {
    openUrl: function(a) {
        chrome.extension.sendMessage({
            action: "openUrl",
            data: {
                url: a
            }
        }, function() {})
    },
    isEditIconF: function() {
        if ("true" == isEditIcon) {
            (a => {
                var b = document.querySelector("link[rel=\"icon\"]");
                null === b ? (b = document.createElement("link"), b.rel = "icon", b.href = a, document.head.appendChild(b)) : b.href = a
            })("https://www.baidu.com/favicon.ico")
        }
    },
    isEditTitleF: function() {
        "true" == isEditTitle && (document.title = "\u767E\u5EA6\u4E00\u4E0B\uFF0C\u4F60\u5C31\u77E5\u9053")
    },
    hideLogoF: function() {
        "true" == hideLogo ? $("img[src='static/image/common/logo.png']").hide() : $("img[src='static/image/common/logo.png']").show()
    },
    hideAvatarF: function() {
        "true" == hideAvatar && $(".plhin .avatar").hide()
    },
    hideSignF: function() {
        "true" == hideSign && $("#nv_forum #postlist .sign").hide()
    },
    autoRefreshF: function() {
        if (autoRefresh > 0) {
            console.log("自动刷新", autoRefresh)
            refreshTimer = setTimeout(function() {
                location.reload();
            }, autoRefresh * 1000);
        }

    },
    hideRemoveWordF: function() {
        if ("true" == hideRemoveWord && removeWords) {
            if (inZkdjt) {
                var a = new RegExp(removeWords.replace(/(,|，)/ig, "|").replace("?", "\\?"));
                $(zkdjtPath).each(function() {
                    var b = $(this),
                        c = b.find("th.common,th.new").find("a.xst").text();
                    c && a.test(c) && b.hide()
                })
            } else if (inZkzx) {
                var a = new RegExp(removeWords.replace(/(,|，)/ig, "|").replace("?", "\\?"));
                $(zkzxPath).each(function() {
                    var b = $(this),
                        c = b.text();
                    c && a.test(c) && b.hide()
                })
            }
        }

    },
    tipsWordsF: function() {
        if ("true" == tipsWords && pushWords) {
            if (inZkdjt) {
                $(zkdjtPath + " .s").mark(pushWords.split(","), {
                    debug: !1,
                    className: "mymark"
                });
                var a = new RegExp(pushWords.replace(/(,|，)/ig, "|").replace("?", "\\?"));
                $(zkdjtPath).each(function() {
                    var b = $(this),
                        c = b.find("th.common,th.new").find("a.xst").text();
                    c && a.test(c) && b.find("th.common,th.new").find("a.xst").css("backgroundColor", "#DDF3FF")
                })
            } else if (inZkzx) {
                $(zkzxPath).mark(pushWords.split(","), {
                    debug: !1,
                    className: "mymark"
                });
                var a = new RegExp(pushWords.replace(/(,|，)/ig, "|").replace("?", "\\?"));
                $(zkzxPath).each(function() {
                    var b = $(this),
                        c = b.text();
                    c && a.test(c) && b.css("backgroundColor", "#DDF3FF")
                })
            }
        }
    },
    isLookF: function() {
        if ("undefined" != typeof localStorage.isLookTzid) {
            isLookTzid = localStorage.isLookTzid;
        }
        if (inZkdjt) {
            $(zkdjtPath + " tr th a.xst").each(function() {
                var a = $(this),
                    b = a.attr("href");
                if (b && -1 < b.indexOf("thread-")) {
                    var c = b.substring(b.indexOf("thread-") + 7, b.indexOf("-1-")); - 1 < isLookTzid.indexOf("," + c + ",") && (a.css("color", "#ccc"), a.css("backgroundColor", "transparent"), a.html(a.text()))
                }
            }), $(zkdjtPath + " tr th a.xst").on("click", function() {
                var a = $(this),
                    b = a.attr("href");
                if (b && -1 < b.indexOf("thread-")) {
                    var c = b.substring(b.indexOf("thread-") + 7, b.indexOf("-1-"));
                    0 > isLookTzid.indexOf("," + c + ",") && (a.css("color", "#ccc"), a.css("backgroundColor", "transparent"), a.html(a.text()), isLookTzid += c + ",", isLookTzid.length > saveTzLength && (isLookTzid = isLookTzid.substring(isLookTzid.length - saveTzLength)), localStorage.isLookTzid = isLookTzid)
                }
            })
        } else if (inZkzx) {
            $(zkzxPath).each(function() {
                var a = $(this),
                    b = a.attr("href");
                if (b && -1 < b.indexOf("thread-")) {
                    var c = b.substring(b.indexOf("thread-") + 7, b.indexOf("-1-")); - 1 < isLookTzid.indexOf("," + c + ",") && (a.css("color", "#ccc"), a.css("backgroundColor", "transparent"), a.html(a.text()))
                }
            }), $(zkzxPath).on("click", function() {
                var a = $(this),
                    b = a.attr("href");
                if (b && -1 < b.indexOf("thread-")) {
                    var c = b.substring(b.indexOf("thread-") + 7, b.indexOf("-1-"));
                    0 > isLookTzid.indexOf("," + c + ",") && (a.css("color", "#ccc"), a.css("backgroundColor", "transparent"), a.html(a.text()), isLookTzid += c + ",", isLookTzid.length > saveTzLength && (isLookTzid = isLookTzid.substring(isLookTzid.length - saveTzLength)), localStorage.isLookTzid = isLookTzid)
                }
            })
        }
    }
};
$(function() {
    var a = location.href;
    if (-1 < a.indexOf("zuixin.php")) {
        inZkzx = !0;
        window.location.hash = "#xad_mu_l_c";
    }
    if (-1 < a.indexOf("forum-15") || -1 < a.indexOf("&fid=15")) {
        inZkdjt = !0, window.location.hash = "#ttp_all"
    }
    (inZkzx || inZkdjt), initCheckbox("isEditIcon", isEditIcon, function(a) {
        isEditIcon = a, main.isEditIconF()
    }), initCheckbox("isEditTitle", isEditTitle, function(a) {
        isEditTitle = a, main.isEditTitleF()
    }), initCheckbox("hideLogo", hideLogo, function(a) {
        hideLogo = a, main.hideLogoF()
    }), initCheckbox("hideAvatar", hideAvatar, function(a) {
        hideAvatar = a, main.hideAvatarF()
    }), initCheckbox("hideSign", hideSign, function(a) {
        hideSign = a, main.hideSignF()
    }), initCheckbox("hideRemoveWord", hideRemoveWord, function(a) {
        hideRemoveWord = a, "true" == hideRemoveWord && initCheckbox("removeWords", removeWords, function(a) {
            removeWords = a, main.hideRemoveWordF()
        })
    }), initCheckbox("autoRefresh", autoRefresh, function(a) {
        autoRefresh = a, main.autoRefreshF()
    }), initCheckbox("tipsWords", tipsWords, function(a) {
        tipsWords = a, "true" == tipsWords && initCheckbox("pushWords", pushWords, function(a) {
            pushWords = a, main.tipsWordsF()
        }), initCheckbox("isLook", isLook, function(a) {
            isLook = a, "true" == isLook && main.isLookF()
        })
    }), $("#um strong.vwmy").after("<span class='pipe'>|</span><a href='javascript:;' id='mycj'>\u63D2\u4EF6</a>"), $("#mycj").on("click", function() {
        main.openUrl("./options.html")
    })
});